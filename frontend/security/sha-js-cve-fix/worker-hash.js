// 子进程：处理耗费资源的哈希计算
const sha = require('sha.js');

const sha256 = (...messages) => {
    const hash = sha('sha256');
    messages.forEach((m) => hash.update(m));
    return hash.digest('hex');
};

// 监听父进程的消息
process.on('message', (data) => {
    try {
        console.log('开始计算 hash')
        const { maliciousDoSObject } = data;

        // 执行耗费资源的哈希计算
        const startTime = Date.now();
        const hash = sha256(maliciousDoSObject);
        const endTime = Date.now();

        console.log('hash 计算完成', `耗时: ${endTime - startTime}ms`)

        // 向父进程发送结果
        process.send({
            type: 'hash_complete',
            hash: hash,
            duration: endTime - startTime,
            success: true
        });

    } catch (error) {
        process.send({
            type: 'hash_error',
            error: error.message,
            success: false
        });
    }
});
